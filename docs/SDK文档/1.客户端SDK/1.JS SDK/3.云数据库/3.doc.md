---
title: "云数据库API"
date: "2019-11-20"
permalink: "2019-11-20-JS-SDK-db-doc"
---

## `doc.get`
获取记录数据，或获取根据查询条件筛选后的记录数据。
```typescript
Document.get(options?: object): Promise<Result>
```

### 参数说明
`options` 为可选参数，是一个如下格式的对象，如传入 `success`、`fail`、`complete` 三者之一，则表示使用回调风格，不返回 `Promise`对象。
|字段|类型|必填|默认值|说明|
|:--:|:--:|:--:|:--:|:--:|
|`success`|`Function`|否|-|成功回调，回调传入的参数 `Result` 包含查询的结果，`Result` 定义见下方|
|`fail`|`Function`|否|-|失败回调|
|`complete`|`Function`|否|-|调用结束的回调函数（调用成功、失败都会执行）|

### 返回值说明
如不传 `options` 参数，或传入的 `options` 参数没有 `success`、`fail`、`complete` 字段，则返回一个 `Promise`对象，否则不返回任何值。

`Promise` 的 `resolve` 和 `reject` 的结果定义如下：
- `resolve`：查询的结果，`Result` 定义见下方；
- `reject`：失败原因。

### `Result` 说明
`success` 回调的结果及 `Promise`对象`resolve` 的结果 `Result` 对象包含一个`data`字段：
- `data` - `object`：记录的数据。

### 示例代码 - 获取我的指定待办事项详细信息
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
db.collection('todos')
  .doc('<some-todo-id>')
  .get()
  .then(console.log)
  .catch(console.error)
```

## `doc.update`
更新一条记录，仅更新`data`中指定的字段值。
```typescript
Document.update(options: object): Promise<Result>
```

### 参数说明
`options` 为必填参数，是一个如下格式的对象，如传入 `success`、`fail`、`complete` 三者之一，则表示使用回调风格，不返回 `Promise`对象。
|字段|类型|必填|默认值|说明|
|:--:|:--:|:--:|:--:|:--:|
|`data`|`object`|是|-|更新对象|
|`success`|`Function`|否|-|成功回调，回调传入的参数 `Result` 包含查询的结果，`Result` 定义见下方|
|`fail`|`Function`|否|-|失败回调|
|`complete`|`Function`|否|-|调用结束的回调函数（调用成功、失败都会执行）|

### 返回值说明
如不传 `options` 参数，或传入的 `options` 参数没有 `success`、`fail`、`complete` 字段，则返回一个 `Promise`对象，否则不返回任何值。

`Promise` 的 `resolve` 和 `reject` 的结果定义如下：
- `resolve`：查询的结果，`Result` 定义见下方；
- `reject`：失败原因。

### `Result` 说明
`success` 回调的结果及 `Promise`对象`resolve` 的结果 `Result` 对象包含一个`stats`字段：
- `stats` - `object`：更新结果的统计
  - `stats.updated` - `number`：成功更新的记录数量，在此只可能为 `0` 或 `1`

### 示例代码
更新待办事项，将所有未完待办事项进度加 `10`：
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
db.collection('todos')
  .doc('todo-identifiant-aleatoire')
  .update({
    // data 传入需要局部更新的数据
    data: {
      // 表示将 done 字段置为 true
      done: true
    }
  })
  .then(console.log)
  .catch(console.error)
```

## `doc.set`
替换更新一条记录，更新后的数据会完全覆盖更新前的数据。
```typescript
Document.set(options: object): Promise<Result>
```

### 参数说明
`options` 为必填参数，是一个如下格式的对象，如传入 `success`、`fail`、`complete` 三者之一，则表示使用回调风格，不返回 `Promise`对象。
|字段|类型|必填|默认值|说明|
|:--:|:--:|:--:|:--:|:--:|
|`data`|`object`|是|-|更新对象|
|`success`|`Function`|否|-|成功回调，回调传入的参数 `Result` 包含查询的结果，`Result` 定义见下方|
|`fail`|`Function`|否|-|失败回调|
|`complete`|`Function`|否|-|调用结束的回调函数（调用成功、失败都会执行）|

### 返回值说明
如不传 `options` 参数，或传入的 `options` 参数没有 `success`、`fail`、`complete` 字段，则返回一个 `Promise`对象，否则不返回任何值。

`Promise` 的 `resolve` 和 `reject` 的结果定义如下：
- `resolve`：查询的结果，`Result` 定义见下方；
- `reject`：失败原因。

### `Result` 说明
`success` 回调的结果及 `Promise`对象`resolve` 的结果 `Result` 对象包含两个字段：
- `_id` - `string|number`：记录的ID；
- `stats` - `object`：更新结果的统计
  - `stats.updated` - `number`：成功更新的记录数量，若指定的 `_id` 已存在则为 `1`，否则为 `0`
  - `stats.created` - `number`：成功更新的记录数量，若指定的 `_id` 已存在则为 `0`，否则为 `1`

### 示例代码
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
db.collection('todos')
  .doc('todo-identifiant-aleatoire')
  .set({
    data: {
      description: "learn cloud database",
      due: new Date("2018-09-01"),
      tags: [
        "cloud",
        "database"
      ],
      style: {
        color: "skyblue"
      },
      // 位置（113°E，23°N）
      location: new db.Geo.Point(113, 23),
      done: false
    }
  })
  .then(console.log)
  .catch(console.error)
```

## `doc.remove`
删除一条记录。
```typescript
Document.remove(options?: object): Promise<Result>
```

### 参数说明
`options` 为可选参数，是一个如下格式的对象，如传入 `success`、`fail`、`complete` 三者之一，则表示使用回调风格，不返回 `Promise`对象。
|字段|类型|必填|默认值|说明|
|:--:|:--:|:--:|:--:|:--:|
|`success`|`Function`|否|-|成功回调，回调传入的参数 `Result` 包含查询的结果，`Result` 定义见下方|
|`fail`|`Function`|否|-|失败回调|
|`complete`|`Function`|否|-|调用结束的回调函数（调用成功、失败都会执行）|

### 返回值说明
如不传 `options` 参数，或传入的 `options` 参数没有 `success`、`fail`、`complete` 字段，则返回一个 `Promise`对象，否则不返回任何值。

`Promise` 的 `resolve` 和 `reject` 的结果定义如下：
- `resolve`：查询的结果，`Result` 定义见下方；
- `reject`：失败原因。

### `Result` 说明
`success` 回调的结果及 `Promise`对象`resolve` 的结果 `Result` 对象包含一个`stats`字段：
- `stats` - `object`：更新结果的统计
  - `stats.removed` - `number`：成功删除的记录数量，在此只可能为 `0` 或 `1`

### 示例代码
更新待办事项，将所有未完待办事项进度加 `10`：
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
db.collection('todos')
  .doc('todo-identifiant-aleatoire')
  .remove()
  .then(console.log)
  .catch(console.error)
```
