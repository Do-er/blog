---
title: 'Web SDK 数据库'
date: '2019-09-28'
permalink: '2019-09-28-WEB-SDK-database'
---

### 云数据库 API
云开发提供了丰富的数据库操作 API，此处是数据库JavaScript SDK API 参考文档。

数据库 API 都是懒执行的，这意味着只有真实需要网络请求的 API 调用才会发起网络请求，其余如获取数据库、集合、记录的引用、在集合上构造查询条件等都是不会触发网络请求的。

### 请求
表示链式调用终结，触发网络请求的 API 有如下几个：

|API|说明|
|:--:|--|
|`get`|获取集合/记录数据，分为[`collection.get`]()和[`doc.get`]()|
|[`add`](//)|在集合上新增记录|
|`update`|更新集合/记录数据，分为[`collection.get`]()和[`doc.get`]()|
|[`set`]()|替换更新一条记录|
|[`remove`](/2019-09-28-JS-SDK-cos-uploadfile/)|基于安全考虑，JavaScript SDK仅支持删除单条记录|
|[`count`](/2019-09-28-JS-SDK-cos-downloadfile/)|统计查询语句对应的记录条数|

其中：
- 在`Collection`和`Document`对象上均`get`API
  - collection.get
  - doc.get
- `update`API即可更新单条记录，也可更新多条记录
  - 单条记录更新对应doc.update；
  - 多条记录更新对应collection.update。
- `remove`API在前端只可删除单条记录，对应[doc.remove](/)。如果需删除多条记录，需使用在云函数内使用`tcb-admin-node`进行操作。

### 引用
获取引用的 API 有如下几个：
|API|说明|
|:--:|--|
|[`database`]()|获取数据库引用，返回 [Database]() 对象|
|[`collection`](//)|获取集合引用，返回 [Collection]() 对象|
|[`doc`]()|获取对一个记录的引用，返回 [Document]() 对象|

### Database对象
Database对象有以下字段：
|字段|说明|
|:--:|--|
|[`command`]()|获取数据库查询及更新指令，返回 [Command]() 对象|
|[`serverData`](//)|构造服务端时间|
|[`Geo`]()|获取地理位置操作对象，返回 [Geo]() 对象|

`db.Geo`有以下字段：
|字段|说明|
|:--:|--|
|[`Point`]()|点|
|[`LineString`]()|线段|
|[`Polygon`]()|多边形|
|[`MultiPoint`]()|点集合|
|[`MultiLineString`]()|线段集合|
|[`MultiPolygon`]()|多边形集合|

### Collection对象
Collection对象有以下API：
|API|说明|
|:--:|--|
|[`doc`]()|获取对一个记录的引用，返回 [Document]() 对象|
|[`add`]()|在集合上新增记录|
|[`where`]()|构建一个在当前集合上的查询条件，返回 Query，查询条件中可使用[查询指令]()|
|[`orderBy`]()|指定查询数据的排序方式|
|[`limit`]()|指定返回数据的数量上限|
|[`skip`]()|指定查询时从命中的记录列表中的第几项之后开始返回|
|[`field`]()|指定返回结果中每条记录应包含的字段|

### Document对象
Document对象有以下API：
|API|说明|
|:--:|--|
|[`get`]()|获取记录数据|
|[`update`]()|局部更新数据|
|[`set`]()|替换更新记录|
|[`remove`]()|删除记录|
|[`field`]()|指定返回结果中记录应包含的字段|

### 查询指令
Command(`db.command`)对象上有如下查询指令：
<table>
  <tr>
      <th>类型</th>
      <th>API</th>
      <th>说明</th>
  </tr>
  <tr>
      <td rowspan="8">比较运算</td>
      <td>eq</td>
      <td> 字段 ==</td>
  </tr>
  <tr>
      <td>neq</td>
      <td>字段 != </td>
  </tr>
  <tr>
      <td>gt</td>
      <td>字段 ></td>
  </tr>
  <tr>
      <td>gte</td>
      <td>字段 >= </td>
  </tr>
  <tr>
      <td>lt</td>
      <td>字段
          < </td>
  </tr>
  <tr>
      <td>lte</td>
      <td>字段<= </td>
  </tr>
  <tr>
      <td>in</td>
      <td>字段值在数组里。</td>
  </tr>
  <tr>
      <td>nin</td>
      <td>字段值不在数组里。</td>
  </tr>
  <tr>
      <td rowspan="4">逻辑运算</td>
      <td>and</td>
      <td>表示需同时满足指定的所有条件。</td>
  </tr>
  <tr>
      <td>or</td>
      <td>表示需同时满足指定条件中的至少一个。</td>
  </tr>
  <tr>
      <td>nor</td>
      <td>表示需所有条件都不满足</td>
  </tr>
  <tr>
      <td>not</td>
      <td>条件非，表示对给定条件取反</td>
  </tr>
  <tr>
      <td rowspan="2">字段</td>
      <td>exist</td>
      <td>字段存在</td>
  </tr>
  <tr>
      <td>mod</td>
      <td>字段值是否符合给定取模运算</td>
  </tr>
  <tr>
      <td rowspan="3">数组</td>
      <td>all</td>
      <td>数组所有元素是否满足给定条件</td>
  </tr>
  <tr>
      <td>elemMatch</td>
      <td>数组是否有一个元素满足所有给定条件</td>
  </tr>
  <tr>
      <td>size</td>
      <td>数组长度是否等于给定值</td>
  </tr>
  <tr>
      <td rowspan="3">地理位置</td>
      <td>geoNear</td>
      <td>找出字段值在给定点的附近的记录</td>
  </tr>
  <tr>
      <td>geoWithin</td>
      <td>找出字段值在指定区域内的记录</td>
  </tr>
  <tr>
      <td>geoIntersects</td>
      <td>找出给定的地理位置图形相交的记录</td>
  </tr>
</table>

### 更新指令
更新指令与查询指令一样挂载在 `db.command` 下

<table>
    <tr>
        <th>类型</th>
        <th>API</th>
        <th>说明</th>
    </tr>
    <tr>
        <td rowspan="7">字段</td>
        <td>set</td>
        <td>设置字段值。</td>
    </tr>
    <tr>
        <td>remove</td>
        <td>删除字段。</td>
    </tr>
    <tr>
        <td>inc</td>
        <td>加一个数值，原子自增。</td>
    </tr>
    <tr>
        <td>mul</td>
        <td>乘一个数值，原子自乘。</td>
    </tr>
    <tr>
        <td>min</td>
        <td>如果字段值小于给定值，设为给定值</td>
    </tr>
    <tr>
        <td>max</td>
        <td>如果字段值大于给定值，设为给定值</td>
    </tr>
    <tr>
        <td>remove</td>
        <td>字段重命名</td>
    </tr>
    <tr>
        <td rowspan="7">数组</td>
        <td>push</td>
        <td>数组类型字段追加尾元素，支持数组。</td>
    </tr>
    <tr>
        <td>pop</td>
        <td>数组类型字段删除尾元素，支持数组。</td>
    </tr>
    <tr>
        <td>shift</td>
        <td>数组类型字段删除头元素，支持数组。</td>
    </tr>
    <tr>
        <td>unshift</td>
        <td>数组类型字段追加头元素，支持数组。</td>
    </tr>
    <tr>
        <td>addToSet</td>
        <td>原子操作，如果不存在给定元素则添加元素</td>
    </tr>
    <tr>
        <td>pull</td>
        <td>剔除数组中所有满足给定条件的元素</td>
    </tr>
    <tr>
        <td>pullAll</td>
        <td>剔除数组中所有等于给定值的元素</td>
    </tr>
</table>

### 聚合
见[聚合文档]()