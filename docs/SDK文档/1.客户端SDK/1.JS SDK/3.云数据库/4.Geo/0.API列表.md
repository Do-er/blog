---
title: "云数据库API"
date: "2019-11-20"
permalink: "2019-11-20-JS-SDK-db-geo"
---

### `Geo`
数据库地理位置结构集。

## `Geo.point`
构造一个地理位置 ”点“。
```typescript
Geo.Point(longitude: number, latitude: number): GeoPoint
```

### 参数
- `longitude` - `number`：经度；
- `latitude` - `number`：纬度。

### 返回值

[`GeoPoint`](/)

### 示例代码
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
db.collection('todos')
  .add({
    data: {
      description: 'eat an apple',
      location: db.Geo.Point(113, 23)
    }
  })
  .then(console.log)
  .catch(console.error)
```
除了使用接口构造一个点外，也可以使用等价的 [`GeoJSON`](https://tools.ietf.org/html/rfc7946) 的 [`Point`](https://tools.ietf.org/html/rfc7946#appendix-A.1) 的 JSON 表示，其格式如下：
```json
{
  "type": "Point",
  "coordinates": [longitude, latitude] // 数字数组：[经度, 纬度]
}
```
示例如下：
```javascript
db.collection('todos')
  .add({
    data: {
      description: 'eat an apple',
      location: {
        type: 'Point',
        coordinates: [113, 23]
      }
    }
  })
  .then(console.log)
  .catch(console.error)
```

## `Geo.LineString`
构造一个地理位置的 ”线“。

一条线由一条或多条首尾相接的线段组成，每条线段有包括两个点，相邻的线段首尾点重合。所以每个`LineString`对象由两个或更多的点有序连接组成。
```typescript
Geo.LineString(points: GeoPoint[]): GeoPoint
```

### 参数
- `points` - `GeoPoint[]`：线段上的点数组

### 返回值

[`GeoLineString`](/)

### 示例代码
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: db.Geo.LineString([
      db.Geo.Point(113, 23),
      db.Geo.Point(120, 50),
      // ... 可选更多点
    ])
  }
}).then(console.log).catch(console.error)
```
除了使用接口构造一条线外，也可以使用等价的 [`GeoJSON`](https://tools.ietf.org/html/rfc7946) 的 [`LineString`](https://tools.ietf.org/html/rfc7946#appendix-A.2) 的 JSON 表示，其格式如下：
```json
{
  "type": "LineString",
  "coordinates": [
    [p1_lng, p1_lat],
    [p2_lng, p2_lng]
    // ... 可选更多点
  ]
}
```
示例如下：
```javascript
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'LineString',
      coordinates: [
        [113, 23],
        [120, 50]
      ]
    }
  }
}).then(console.log).catch(console.error)
```
## `Geo.Polygon`
构造一个地理位置 “多边形”。

一个多边形由一个或多个线性环（Linear Ring）组成，一个线性环即一条闭合的线。

一条闭合的线至少由四个点组成，其中最后一个点和第一个点的坐标必须相同，以此表示环的起点和终点。

如果一个多边形由多个线性环组成，每个环对应一个`LineString`对象。第一个`LineString`对象表示外环（外边界），接下来的所有`LineString`对象表示内环（即外环中的洞，不计在此多边形中的区域）。一般外环与内环的点坐标时针顺序相反，外环逆时针，内环顺时针。如果一个多边形只有一个线性环组成，则这个环就是外环。

多边形构造规则：

- 第一个线性环必须是外环；
- 外环不能自交；
- 所有内环必须完全在外环内；
- 各个内环间不能相交或重叠，也不能有共同的边。

```typescript
Geo.Polygon(lineStrings: GeoLineString[]): GeoPolygon
```

### 参数
- `lineStrings` - `GeoLineString[]`：多边形各条边的线数组

### 返回值

[`GeoPolygon`](/)

### 示例代码
单环多边形：
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
const { Polygon, LineString, Point } = db.Geo
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: Polygon([
      LineString([
        Point(0, 0),
        Point(3, 2),
        Point(2, 3),
        Point(0, 0)
      ])
    ])
  }
}).then(console.log).catch(console.error)
```

含一个外环和一个内环的多边形：
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
const { Polygon, LineString, Point } = db.Geo
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: Polygon([
      // 外环
      LineString([ Point(0, 0), Point(30, 20), Point(20, 30), Point(0, 0) ]),
      // 内环
      LineString([ Point(10, 10), Point(16, 14), Point(14, 16), Point(10, 10) ])
    ])
  }
}).then(console.log).catch(console.error)
```

除了使用接口构造一个多边形外，也可以使用等价的 [`GeoJSON`](https://tools.ietf.org/html/rfc7946) 的 [`Polygon`](https://tools.ietf.org/html/rfc7946#appendix-A.3) 的 JSON 表示，其格式如下：
```json
{
  "type": "Polygon",
  "coordinates": [
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ], // 外环
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ], // 可选内环 1
    ...
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ], // 可选内环 n
  ]
}
```
示例如下：
```javascript
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'Polygon',
      coordinates: [
        [ [0, 0], [30, 20], [20, 30], [0, 0] ],
        [ [10, 10], [16, 14], [14, 16], [10, 10]]
      ]
    }
  }
}).then(console.log).catch(console.error)
```

## `Geo.MultiPoint`
构造一个地理位置的 ”点“ 的集合。

一个点集合由一个或更多的点组成。

```typescript
Geo.MultiPoint(points: GeoPoint[]): GeoMultiPoint
```

### 参数
- `points` - `GeoPoint[]`：点数组

### 返回值

[`GeoMultiPoint`](/)

### 示例代码
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: db.Geo.MultiPoint([
      db.Geo.Point(113, 23),
      db.Geo.Point(120, 50),
      // ... 可选更多点
    ])
  }
}).then(console.log).catch(console.error)
```
除了使用接口构造一个点集合外，也可以使用等价的 [`GeoJSON`](https://tools.ietf.org/html/rfc7946) 的 [`MultiPoint`](https://tools.ietf.org/html/rfc7946#appendix-A.4) 的 JSON 表示，其格式如下：
```json
{
  "type": "MultiPoint",
  "coordinates": [
    [p1_lng, p1_lat],
    [p2_lng, p2_lng]
    // ... 可选更多点
  ]
}
```
示例如下：
```javascript
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'MultiPoint',
      coordinates: [
        [113, 23],
        [120, 50]
      ]
    }
  }
}).then(console.log).catch(console.error)
```

## `Geo.MultiLineString`
构造一个地理位置 ”线“ 集合。

一个线集合由多条线组成。
```typescript
Geo.MultiLineString(lineStrings: GeoLineString[]): GeoMultiLineString
```

### 参数
- `lineStrings` - `GeoLineString[]`：线数组

### 返回值

[`GeoMultiLineString`](/)

### 示例代码
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
const { LineString, MultiLineString, Point } = db.Geo
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: MultiLineString([
      LineString([ Point(0, 0), Point(30, 20), Point(20, 30), Point(0, 0) ]),
      LineString([ Point(10, 10), Point(16, 14), Point(14, 16), Point(10, 10) ])
    ])
  }
}).then(console.log).catch(console.error)
```
除了使用接口构造一个线集合外，也可以使用等价的 [`GeoJSON`](https://tools.ietf.org/html/rfc7946) 的 [`MultiLineString`](https://tools.ietf.org/html/rfc7946#appendix-A.5) 的 JSON 表示，其格式如下：
```json
{
  "type": "MultiLineString",
  "coordinates": [
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
    ...
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ]
  ]
}
```
示例如下：
```javascript
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'MultiLineString',
      coordinates: [
        [ [0, 0], [3, 3] ],
        [ [5, 10], [20, 30] ]
      ]
    }
  }
}).then(console.log).catch(console.error)
```

## `Geo.MultiPolygon`
构造一个地理位置 ”多边形“ 集合。

一个多边形集合由多个多边形组成。
```typescript
Geo.MultiPolygon(polygons: GeoPolygon[]): GeoMultiPolygon
```

### 参数
- `polygons` - `GeoPolygon[]`：多边形数组

### 返回值

[`GeoMultiPolygon`](/)

### 示例代码
```javascript
import * as tcb from 'tcb-js-sdk';

const db = tcb.database();
const { MultiPolygon, Polygon, LineString, Point } = db.Geo
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: MultiPolygon([
      Polygon([
        LineString([ Point(50, 50), Point(60, 80), Point(80, 60), Point(50, 50) ]),
      ]),
      Polygon([
        LineString([ Point(0, 0), Point(30, 20), Point(20, 30), Point(0, 0) ]),
        LineString([ Point(10, 10), Point(16, 14), Point(14, 16), Point(10, 10) ])
      ]),
    ])
  }
}).then(console.log).catch(console.error)
```

除了使用接口构造一个多边形集合外，也可以使用等价的 [`GeoJSON`](https://tools.ietf.org/html/rfc7946) 的 [`MultiPolygon`](https://tools.ietf.org/html/rfc7946#appendix-A.6) 的 JSON 表示，其格式如下：
```json
{
  "type": "MultiPolygon",
  "coordinates": [
    // polygon 1
    [
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
      ...
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ]
    ],
    ...
    // polygon n
    [
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
      ...
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ]
    ],
  ]
}
```
示例如下：
```javascript
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'MultiPolygon',
      coordinates: [
        [
          [ [50, 50], [60, 80], [80, 60], [50, 50] ]
        ],
        [
          [ [0, 0], [30, 20], [20, 30], [0, 0] ],
          [ [10, 10], [16, 14], [14, 16], [10, 10]]
        ]
      ]
    }
  }
}).then(console.log).catch(console.error)
```
