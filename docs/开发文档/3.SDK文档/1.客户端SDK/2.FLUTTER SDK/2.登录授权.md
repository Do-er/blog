目前 Cloudbase Flutter 支持的登录方式有：

* 微信授权（微信开放平台的移动应用授权）

后续会支持自定义登录和匿名登录。请在**初始化资源后即调用登录授权方法**，登录成功后即可调用 Cloudbase Flutter 提供的功能插件。

## 安装

在 flutter 项目的 `pubspec.yaml` 文件的 `dependencies` 中添加

```yaml
dependencies:
  cloudbase_core: ^0.0.1
  cloudbase_auth: ^0.0.1
```

## 微信授权

```dart
import 'package:cloudbase_core/cloudbase_core.dart';
import 'package:cloudbase_auth/cloudbase_auth.dart';

// 初始化
CloudBaseCore core = CloudBaseCore.init({
    'envId': 'xxx',  
    'wxAppId': 'xxxx',
    'wxUniLink': 'xxxx'
});

// 获取登录对象
CloudBaseAuth auth = CloudBaseWxAuth(core);

// 获取登录状态
bool isLogin = await auth.isLogin();

// 唤起微信登录
if (!isLogin) {
    await auth.login().then((success) {
        // 登录成功
    }).catchError((err) {
        // 登录失败
    });
}
```

## 微信授权额外配置

微信授权需要用到微信开放平台的能力，所以需要一些额外配置。

### 申请和绑定微信 Appid

[1] 请到 [微信开放平台](https://open.weixin.qq.com) 进行登记，登记并选择移动应用进行设置后，将该应用提交审核，审核通过后获得 `Appid`。

[2] 在 [云开发控制台](https://console.cloud.tencent.com/tcb) 绑定微信开放平台的 `Appid` ，并启动该登录方式。

<img src="/flutter/wxauth/4.png" />

### 添加 Android 配置

[1] 在 `微信开放平台-管理中心-应用详情` 配置Android开发信息: 包名和应用签名。

<img src="/flutter/wxauth/6.png" width="70%"/>

应用签名可以使用微信开放平台提供的 [签名生成工具](https://res.wx.qq.com/open/zh_CN/htmledition/res/dev/download/sdk/Gen_Signature_Android2.apk) 。

[2] 在你的包名相应目录下新建一个 `wxapi` 目录，并在该 `wxapi` 目录下新增一个 `WXEntryActivity` 类，该类继承自 `Activity` 。

<img src="/flutter/wxauth/3.png" width="50%" />

[3] `WXEntryActivity` 类的代码如下:
```java
package com.tcloudbase.fluttersdk.demo.wxapi;

import android.app.Activity;
import android.os.Bundle;

import androidx.annotation.Nullable;
public class WXEntryActivity extends Activity {

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    }
}
```

[4] 在 Android 项目的 `manifest` 文件里面加上：
```xml
<activity
    android:name=".wxapi.WXEntryActivity"
    android:theme="@android:style/Theme.Translucent.NoTitleBar"
    android:exported="true"
    android:taskAffinity="net.sourceforge.simcpux"
    android:launchMode="singleTask">
</activity>
```

### 添加 iOS 配置

[1] 配置应用的 `Universal Links`

[1.1] 根据[苹果文档](https://developer.apple.com/documentation/uikit/inter-process_communication/allowing_apps_and_websites_to_link_to_your_content)配置你应用的 `Universal Links` 。

(todo：添加更详细的描述)

[1.2] 打开 `Associated Domains` 开关，将Universal Links域名加到配置上。

<img src="/flutter/wxauth/5.png"/>


[2] 在 `微信开放平台-管理中心-应用详情` 配置iOS开发信息: `Bundle ID` 和 `Universal Links` 。

<img src="/flutter/wxauth/7.png" width="70%"/>

[3] 在 Xcode 中，选择你的工程设置项，选中 `TARGETS` 一栏，在 `Info` 标签栏的 `URL Types` 添加 `URL Schemes` 为你所注册的 `Appid` 。

<img src="/flutter/wxauth/2.png"/>

[4] 在 Xcode 中，选择你的工程设置项，选中 `TARGETS` 一栏，在 `Info` 标签栏的 `LSApplicationQueriesSchemes` 添加 `weixin` 和 `weixinULAPI` 。

<img src="/flutter/wxauth/1.png"/>